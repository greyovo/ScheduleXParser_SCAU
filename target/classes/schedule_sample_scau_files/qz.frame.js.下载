"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,s=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(s)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _Qz=Qz,frameService=_Qz.frameService;Vue.component("nav-menu",{name:"nav-menu",template:'<div class="menu-wrapper">\n  <template v-for="(menu, index) in menuList">\n    <el-submenu v-if="menu.children.length" :index="menu.index" v-show="version?version:menu.isShow===true">\n      <template slot="title">\n        <i :class="[menu.pic ? menu.pic : \'fa-spinner5\']"></i>\n        <span>{{menu.label}}</span>\n      </template>\n      <nav-menu class="nest-menu" :menu-list="menu.children" @favorite="onFavorite" :version="version"></nav-menu>\n    </el-submenu>\n    <el-menu-item v-else @mouseover.native="itemTouched($event, menu, index)"  @mouseout.native="itemLeaved($event, index)" :data-url="menu.index" :index="menu.index" v-show="version?version:menu.isShow!==false">\n      <span slot="title">\n        {{menu.label}}\n      </span>\n      <i class="icon-favorite el-icon-star-off" v-if="!menu.favorite" @click="onFavorite(menu)"></i>\n      <i class="icon-favorite el-icon-star-on" v-if="menu.favorite" @click="onFavorite(menu)"></i>\n       <el-tooltip \n       effect="dark" \n       :ref="menu.index"\n       :content="tooltipContent"\n       placement="right"\n       :manual="true"\n       :value="tooltipValue === menu.index"\n      >\n      <span style="visibility: hidden;position:absolute;right:0;top:15px;"></span>\n      </el-tooltip>\n     </el-menu-item>\n     \n  </template>\n</div>',props:{menuList:{type:Array,required:!0},version:Boolean},data:function(){return{tooltipContent:"",timer:"",leaveTime:"",tooltipValue:""}},computed:{},mounted:function(){},methods:{itemTouched:function(e,t){var n=this;this.leaveTime&&clearTimeout(this.leaveTime),this.timer=setTimeout(function(){e.ctrlKey&&Qz.frameService.showLinkInfo(t.code).then(function(e){n.tooltipContent=e.pathIndexToCodeName,n.tooltipValue=t.index})},50)},itemLeaved:function(){var e=this;this.$nextTick(function(){clearTimeout(e.timer),e.leaveTime=setTimeout(function(){e.tooltipValue=""},2e3)})},onFavorite:function(e){this.$emit("favorite",e)}}}),Qz.init().then(function(e){var t=_slicedToArray(e,2),n=t[0],i=t[1],s="2"===Qz.settings.blank?{path:"/",name:"dashboard",component:Qz.component({module:"dashboard",template:"dashboard.html",scripts:["dashboard.service.js","dashboard.js"]})}:{path:"/",name:"dashboard",component:{template:"<div></div>",created:function(){var t=this;http.postJSON("GRZX01_jwPublic.controller.UserIndexController.findUserDetail",{sctype:"hnnydx",userType:Qz.loginUser.userType||""},{},{loading:!1}).then(function(e){e.holder.userInfo.emails||"system"==e.holder.userInfo.usertypes||null==e.holder.userInfo.usertypes||""!=Qz.getCv("simulatedBy")()||("1"==Qz.settings.sfemail?t.$dialog({app:"dashboard",template:"dashboard-set-email.html",scripts:["dashboard.set.email.js"]},{}).then(function(){location.reload()}):alert("检测到您邮箱为空，请在个人信息核对中维护您的邮箱！"))})}}},o=[{path:"/:id",name:"dashboard",component:Qz.component({module:"dashboard",template:"dashboard.html",scripts:["dashboard.service.js","dashboard.js"]})},{path:"/zygl/frame-page/",name:"frame",component:Qz.component({module:"frame-page",template:"frame.html",scripts:["frame.js"]})}];Object.keys(Qz.routes).forEach(function(n){Qz.routes[n].forEach(function(e){var t="/"+n+"/"+e.name+"/";e.path,e.path=e.path||t,e.component=Qz.component({app:n,module:e.name,template:e.name+".html",scripts:e.scripts}),o.push({path:e.path,name:e.name,component:e.component,meta:{resCode:e.resCode,workflow:e.workflow,cache:e.workflow?!e.workflow:e.cache}})})}),o.unshift(s);var a=new VueRouter({routes:o});window.app=new Vue({el:"#app",router:a,store:i,components:{dialogMessage:Qz.component({module:"custom-page",template:"dialog-message.html",scripts:["dialog.message.js"]})},data:function(){return{resCode:"ZYGL9901",isFullscreen:!1,closeTabIndex:1,language:Qz.settings.language,favoriteMenuList:[],historyMenuList:[],menuList:[],roleList:[],roleCode:"",tabs:[{label:"zh_CN"===Qz.settings.language?"个人中心":"User Center",name:"/",closable:!1}],containerHeight:"",windowWidth:"",version_expand:!1,showMenuChild:!1,menuObj:"",menuObjSession:{},mouseObj:{clientX:""},mapRouter:{},menuMap:{},firstMenuHeight:"",isShowFirstIcon:!1,isShowDialogMessage:!1,arrowMenuShow:!1,firstMenuColor:["#178fe6","#1cc898","#555dba8","#eec224","#f2766d","fbb289","#7a9fff"],newMessageData:[],messageNoticeObj:""}},computed:{workflowTag:function(){return this.$route.meta.workflow},userInfo:function(){var e=Qz.getCv("simulatedBy")()?"("+(this.resI18n.lb_simulatedUser||"模拟用户")+")":"";return this.loginUser.name+e},isCollapse:function(){return this.$store.state.hideNavMenu},tabRouteNames:function(){var e=(this.usersettingsSession?this.tabs.filter(function(e){return!1!==e.cache}):this.tabs.filter(function(e){return!0===e.cache})).map(function(e){var t=e.componentName;if(!t){var n=(-1<e.name.indexOf("target=_inner")?"/zygl/frame/":e.name).split("/");n[2]&&(t=n[2].replace(/\?.+/,""))}return t});return this.usersettingsSession&&e.push("dashboard"),e.join(",")},excRouteNames:function(){var e=[],t=(this.usersettingsSession?this.tabs.filter(function(e){return!1===e.cache}):this.tabs.filter(function(e){return!1!==e.cache})).map(function(e){var t=e.componentName;if(!t){var n=(-1<e.name.indexOf("target=_inner")?"/zygl/frame/":e.name).split("/");n[2]&&(t=n[2].replace(/\?.+/,""))}return t});return e=[].concat(_toConsumableArray(t)),this.workflowTag&&e.push(this.$route.name),e.join(",")},isShowSubMenu:function(){return this.haveMenuChild&&this.showMenuChild},haveMenuChild:function(){return this.menuObj&&this.menuObj.children&&this.menuObj.children.length},menuListChild:function(){var s=[],o=this.menuObj;return this.menuList.forEach(function(e){var t,n,i=e.code===o.code;t=e.children,n=i,t.forEach(function(e){e.isShow=n}),e.children.length&&s.push.apply(s,_toConsumableArray(e.children))}),s},isopen:function(){var t=this;return 0==this.tabs.findIndex(function(e){return e.name===t.$route.path})},isopen1:function(){var t=this;return this.tabs.findIndex(function(e){return e.name===t.$route.path})==this.tabs.length-1},path:function(){var e=this.$route.path,t=this.$route.query;return t.src&&-1<t.src.indexOf("target=_inner")?t.src:this.mapRouter[e]||e},messageList:function(){return this.$store.state.m.messageList},messageData:function(){return this.messageList.filter(function(e){return"1"===e.promptModel})},noticeData:function(){return this.messageList.filter(function(e){return"2"===e.promptModel})},newMsg:function(){return!!this.messageData.length}},created:function(){var t=this;this.initRoleList(),this.setMapRouter(n),this.menuList=n,"system"!=this.loginUser.userType&&0<this.menuList.length&&this.handleMenu(this.menuList[0].code),Qz.switch.selectCourse||frameService.favoriteMenuList().then(function(e){e.forEach(function(e){t.menuMap[e]&&(t.menuMap[e].favorite=!0,t.favoriteMenuList.push(t.menuMap[e]))})}).catch(function(e){})},watch:{isFullscreen:function(e){e&&$message(this.resI18n.lb_screen_tips||"双击选项卡取消全屏"),this.$store.commit("windowSizeChangeToggle"),this.changeTableHeight(),this.setFirstMenuHeight()},$route:function(e){var t=e.path,n=e.meta,i=e.name;t=this.path,this.path.split("/").length<=2&&(this.tabs[0].name=this.path);var s=this.tabs.find(function(e){return e.name===t}),o={};if(this.menuObjSession[t])o=this.menuObjSession[t],this.menuObj=o;else for(var a=0,r=this.menuList.length;a<r;a++){if(this.findMenuChild(this.menuList[a],t)){o=Object.assign({},this.menuObj,this.menuList[a]),this.$set(this.menuObjSession,t,this.menuList[a]),this.menuObj=o;break}}if(!s){var u=filterMenu(this.menuList,t);u&&this.tabs.push({label:u.label,name:u.index,closable:!0,cache:n.cache,componentName:i,code:u.code})}},messageList:function(){this.$nextTick(function(){this.saveLocalMessageData()})}},methods:{showMessageDialog:function(){this.messageList.length&&this.$dialog({module:"custom-page",template:"message-center-dialog.html",scripts:["message.center.dialog.js"]}).then(function(e){})},openMessageNotice:function(t){var n=this;if(!this.messageNoticeObj){var e,o=0,i=this.$createElement,a=void 0,r=void 0,u=document.body.getBoundingClientRect().bottom,s=document.createElement("div");s.innerHTML=t.content,a=s.innerText,s=null,function(e,t){var n=0,i=void 0,s=!1;for(i=0;i<e.length;i++){if(t<n){s=!0;break}n+=e.charCodeAt(i)<127?1:2}a=s?e.slice(0,i-1)+"...":e.slice(0,i-1),r=Math.ceil(Math.ceil(n/2)/24),o=u-(97+21*r+16+16)}(a,188),e=i("div",{class:{"notice-content":!0}},[a,i("div",{},[i("ElButton",{props:{type:"text"},class:{right:!0},on:{click:function(e){e.preventDefault(),n.messageNoticeClick(t)}}},this.resI18n.lb_see||"查看")])]),this.messageNoticeObj=this.$notify({title:t.title,message:e,duration:window.Qz.config.opts.showTime,offset:o,onClose:this.messageNoticeClose,customClass:"notice-ellipsis"})}},messageNoticeClick:function(e){if(this.messageNoticeObj){var t={messageDetailId:e.messageDetailId};e.functionUrl?this.$router.push({path:e.functionUrl,query:t}):this.$router.push({path:"/xxzx/receive-msg",query:t}),this.messageNoticeObj.close(),this.messageNoticeObj=null}},messageNoticeClose:function(){this.messageNoticeObj=null},openMessageDialog:function(e){var t=this;this.newMessageData.push(e),this.isShowDialogMessage||this.$dialog({module:"custom-page",template:"dialog-message.html",scripts:["dialog.message.js"]},this.newMessageData).then(function(e){t.closeMessageDialog(e)}),this.isShowDialogMessage=!0},closeMessageDialog:function(t){this.isShowDialogMessage=!1,this.newMessageData=this.newMessageData.filter(function(e){return!t.includes(e.messageDetailId)}),this.$store.commit("m/delete",t)},handleMessageInfo:function(e){"1"===e.promptModel?(this.$store.commit("m/add",e),this.openMessageNotice(e)):"2"===e.promptModel&&(this.$store.commit("m/add",e),this.openMessageDialog(e))},saveLocalMessageData:function(){try{localStorage.setItem(this.loginUser.username+":messageList",JSON.stringify(this.messageList))}catch(e){localStorage.clear()}},getLocalMessageData:function(){var t=this,e=localStorage.getItem(this.loginUser.username+":messageList");e&&(e=JSON.parse(e)).forEach(function(e){return t.$store.commit("m/add",e)})},setFirstMenuHeight:function(){this.$nextTick(function(){var e=this.$refs.sidebar.getBoundingClientRect().height,t=35*this.menuList.length+15,n=Math.max(e,t);this.firstMenuHeight=n})},getHistoryMenu:function(){var t=this;frameService.getHistoryMenu({count:"8"}).then(function(e){(e=e||[]).forEach(function(e){t.menuMap[e]&&t.historyMenuList.push(t.menuMap[e])})}).catch(function(e){})},postHistoryMenu:function(e){frameService.postHistoryMenu(e).then(function(e){}).catch(function(e){})},setMapRouter:function(e){var n=this;e.forEach(function(e){if(-1<e.index.indexOf("?")){var t=e.index.split("?");n.$set(n.mapRouter,t[0],e.index)}e.favorite=!1,n.$set(n.menuMap,e.code,e),e.children&&n.setMapRouter(e.children)})},findMenuChild:function(e,t){var n=this;if(Array.isArray(e)){var i=void 0;if(e.forEach(function(e){n.findMenuChild(e,t)&&(i=!0)}),i)return!0}else{if(e.index===t)return!0;if(e.children.length)return this.findMenuChild(e.children,t)}},menuMousemove:function(e){(e.clientX<0||200<=e.clientX)&&(this.showMenuChild=!0)},menuChildMouseout:function(e){160<e.clientX&&(this.showMenuChild=!0,this.isShowSubMenu&&(this.arrowMenuShow=!0)),this.mouseObj.clientX=e.clientX},menuChildMousemove:function(e){e.clientX<3&&this.mouseObj.clientX>e.clientX&&(this.showMenuChild=!1,this.arrowMenuShow=!1),this.mouseObj.clientX=e.clientX},hideMenuChild:function(){this.showMenuChild=!this.showMenuChild,this.arrowMenuShow=!0},showMenuChildEvent:function(){this.isShowFirstIcon=!1,this.showMenuChild=!this.showMenuChild,this.arrowMenuShow=!1},handleMenu:function(t){this.showMenuChild=!0,this.arrowMenuShow=!1,this.menuObj=this.menuList.find(function(e){return e.index==t}),this.menuObj&&(this.arrowMenuShow=!0)},changeNav:function(){this.$store.commit("navMenuToggle")},resize:function(e){this.$store.commit("windowSizeChangeToggle");var t=(e.target||e.srcElement).innerWidth,n=this.windowWidth,i=0<t-n?1:t===n?0:-1;this.windowWidth=t,this.$store.commit("windowWidthChange",i),this.changeTableHeight(),this.setFirstMenuHeight()},onTabClick:function(e){this.goMenu(e.name)},onTabRemove:function(t){var e=this.tabs.findIndex(function(e){return e.name===t});this.closeTabIndex=e,this.tabs.splice(e,1);var n=this.tabs[e-1];t===this.path&&this.goMenu(n.name)},initRoleList:function(){var e=this,t=window.Qz.roleListInfo,n=t.roleCode,i=t.roleList;this.roleList=i,this.$nextTick(function(){e.roleCode=n})},localStorageForSettings:function(t){var e=Qz.loginUser.username+":config",n=localStorage.getItem(e);n&&(n=JSON.parse(n),Object.keys(t).forEach(function(e){n[e]=t[e]}),localStorage.setItem(e,JSON.stringify(n)))},switchRole:function(e,t){var n=this,i=_slicedToArray(t,2),s=i[0],o=void 0===s?"":s,a=i[1],r=void 0===a?"":a;(r=r.slice(o.length))||(r=o,o="");var u=JSON.stringify({agent:o,roleCode:r});frameService.switchRole(r,o).then(function(e){n.localStorageForSettings({userRole:u});var t=window.location.origin+window.location.pathname;window.location.href=t})},goMenu:function(t){if(-1<t.indexOf("target=_new"))window.open(t);else{if(this.tabs.length>=Qz.tabsCount){var e=this.tabs.find(function(e){return e.name===t});if("default"===Qz.settings.tabs){if(!e){var n=(this.resI18n.lb_tabs_count||"标签数量限制为[{%s}]个!").replace(/{%s}/,Qz.tabsCount);return void this.$message(n)}}else e||this.tabs.splice(1,1)}if(-1<t.indexOf("target=_inner"))return this.$set(this.mapRouter,t,"/zygl/frame-page"),void this.$router.push({path:"/zygl/frame-page",query:{src:t}});this.$router.push({path:t}),this.$refs["popover-favorite-menu"].showPopper=!1}},logout:function(){var e=Qz.getCv("simulatedBy")();(e=e&&window.encodeURIComponent(e))?http.postJSON(""+location.origin+Qz.secApiPath+"/simulateLogout?Simulated-By="+e+"&resourceCode=resourceCode&apiCode=framework.sign.controller.SignController.logout").then(function(e){Qz.setCookie("token",e.TOKEN),location.href=e.service}):http.postJSON(""+location.origin+Qz.secApiPath+"/logout?resourceCode=resourceCode&apiCode=framework.sign.controller.SignController.logout").then(function(e){location.href=e,Qz.removeCookie("token")})},showSettingsDialog:function(){this.$dialog({module:"user-settings",template:"custom-settings-dialog.html",scripts:["custom.settings.service.js","custom.settings.dialog.js"]}).then(function(e){location.reload()})},goRight:function(){var t=this.path,e=this.tabs.findIndex(function(e){return e.name===t})+1;if(this.tabs.length>e){var n=this.tabs[e].name;n&&this.goMenu(n)}},goLeft:function(){var t=this.path,e=this.tabs.findIndex(function(e){return e.name===t});if(0!==e){var n=this.tabs[e-1].name;n&&this.goMenu(n)}},onTabClose:function(e){var t=this.mapRouter[this.$route.path]||this.$route.path,n=this.tabs.findIndex(function(e){return e.name===t});"me"===e?n&&(this.tabs.splice(n,1),this.onTabClick(this.tabs[n-1])):"all"===e?(this.tabs.splice(1),this.onTabClick(this.tabs[0])):"right"===e?this.tabs.splice(n+1):"others"===e&&(this.tabs=this.tabs.filter(function(e,t){return 0===t||t===n}))},onFavorite:function(t){var n=this;t.favorite?frameService.delFavoriteMenu(t.code).then(function(){n.$set(t,"favorite",!1);var e=n.favoriteMenuList.findIndex(function(e){return e.url===t.url});n.favoriteMenuList.splice(e,1),$message(n.resI18n.lb_collection_cancel||"取消收藏成功")}).catch(function(e){n.$message(n.resI18n.lb_collection_cancel_failure||"取消收藏失败")}):frameService.addFavoriteMenu(t.code).then(function(){n.$set(t,"favorite",!0),n.favoriteMenuList.push(t),$message(n.resI18n.lb_collection_success||"添加收藏成功")}).catch(function(e){n.$message(n.resI18n.lb_collection_failure||"添加收藏失败")})}},mounted:function(){var t=this;window.addEventListener("resize",function(e){throttle(t.resize,null,20,e,100)},!1),this.windowWidth=window.innerWidth,this.getHistoryMenu(),this.setFirstMenuHeight();try{if(void 0===this.$socket.readyState)return void this.$notify({title:this.resI18n.lb_title1||"浏览器不支持消息提醒",message:this.resI18n.lb_message_msg||"当前浏览器不支持消息提醒，请使用新版谷歌浏览器！",duration:0,customClass:"notice-ellipsis"});var e=window.Qz.settings.websocket;if(e){var n=location.host,i=0===e.indexOf("ws")?e:"ws://"+n+e;window.Qz.config.ws=i;var s={authcode:this.loginUser.username,identity:this.loginUser.username,TOKEN:Qz.getCookie("token",!1),accessToken:Qz.getCv("sid")()};this.$socket.open(!1,s)}else this.$notify.error({title:this.resI18n.lb_msg_frame||"当前系统未配置消息管理中心",message:"",duration:0,offset:60,customClass:"notice-ellipsis"})}catch(e){}document.title=Qz.settings.reportunit||"",setTimeout(function(){t.getLocalMessageData()}),this.$socket.addEventListener("error",function(e){t.$message("WebSocket connection failed")})},socket:{events:{message:function(e){"string"!=typeof e&&this.handleMessageInfo(e)},foreCache:function(e){var t=e.content;this.$appStore.dispatch(t.type,Object.assign(t.value,{isMsg:!0}))}}}}),a.afterEach(function(e){var t=filterMenu(app.menuList,e.path),n=Qz.settings.reportunit||"";t&&(n=t.name+" -  "+n,2!==t.index.split("/").length&&app.postHistoryMenu(t.code));document.title=n})});var filterMenu=function e(t,n){var i=!0,s=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var u=a.value;if(u.index===n)return u;var h=e(u.children,n);if(h)return h}}catch(e){s=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(s)throw o}}};